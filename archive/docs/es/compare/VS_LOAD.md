# Load Test Report

동일 데이터(87,723,475 Lucene docs)를 다른 인덱스/샤드 구조로 분배했을 때
**동시 사용자 수 증가에 따른 throughput과 latency 변화**를 측정한다.

인덱스 구조, 인덱싱/forcemerge 소요시간, 환경 스펙은 [INDEX.md](../benchmark/INDEX.md) 참조.

## Tool

- **locust** (Python)
- 스크립트: `locustfile.py`
- 쿼리 생성: `VS_FORCEMERGE_BENCH.py`의 `generate_filter_combo`, `combo_to_query` 재사용

## Test Configuration

| Param | Value |
|-------|-------|
| Target | OpenSearch (`request_cache=false`) |
| bbox | 전국 고정 + ±0.05도 jitter |
| agg level | sd / sgg / emd round-robin |
| agg size | 제한 없이 전체 반환 (sd=100, sgg=10000, emd=100000) |
| filter | 토지(60%)/건물(50%)/실거래(50%) 랜덤 조합 |
| seed | 고정 (재현 가능) |

## Load Profile

단계별 동시 사용자 수를 증가시켜 saturation point를 찾는다.

| Stage | Users | Duration | Ramp-up |
|-------|-------|----------|---------|
| 1     | 1     | 60s      | -       | baseline (단일 쿼리 레이턴시)
| 2     | 5     | 60s      | 10s     |
| 3     | 10    | 60s      | 10s     |
| 4     | 20    | 60s      | 10s     |
| 5     | 50    | 60s      | 10s     |

## Metrics

| Metric | Description |
|--------|-------------|
| RPS (Requests Per Second) | 초당 처리 요청 수 |
| avg latency | 평균 응답 시간 |
| p50 / p90 / p95 / p99 | 응답 시간 백분위수 |
| error rate (%) | 실패 비율 (timeout / 5xx) |
| saturation point | RPS가 더 이상 증가하지 않는 동시 사용자 수 |

---

## Results

### 4/4 local f (forcemerge 완료)

> 기본 구조. 다른 구조와 비교 기준.

#### sd (시도)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

#### sgg (시군구)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

#### emd (읍면동)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

---

### 1/16 local f (forcemerge 완료)

#### sd (시도)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

#### sgg (시군구)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

#### emd (읍면동)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

---

### 2/3 local f (forcemerge 완료)

#### sd (시도)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

#### sgg (시군구)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

#### emd (읍면동)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

---

### 17/2 local f (forcemerge 완료)

#### sd (시도)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

#### sgg (시군구)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

#### emd (읍면동)

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 1     |     |     |     |     |     |     |        |
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

---

## Analysis

### Saturation Point

| Case | agg | Saturate Users | Max RPS | p99 at saturation |
|------|-----|----------------|---------|-------------------|
| 4/4 local f  | sd  |  |  |  |
| 4/4 local f  | sgg |  |  |  |
| 4/4 local f  | emd |  |  |  |
| 1/16 local f | sd  |  |  |  |
| 1/16 local f | sgg |  |  |  |
| 1/16 local f | emd |  |  |  |
| 2/3 local f  | sd  |  |  |  |
| 2/3 local f  | sgg |  |  |  |
| 2/3 local f  | emd |  |  |  |
| 17/2 local f | sd  |  |  |  |
| 17/2 local f | sgg |  |  |  |
| 17/2 local f | emd |  |  |  |

### Conclusion

TODO
