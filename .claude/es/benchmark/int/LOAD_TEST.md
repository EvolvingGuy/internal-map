# Load Test (INT)

## Environment

| Item          | Value                                  |
|---------------|----------------------------------------|
| OpenSearch    | 2.11.1 (AWS OpenSearch Service)        |
| Instance      | r6g.large (2 vCPU, 16GB)              |
| Nodes         | 3                                      |
| JVM Heap      | 8GB (per node)                         |
| Locust        | localhost → Spring app → Remote OS     |
| Think Time    | 2~5 second (between)                   |
| Spawn Rate    | 10 users/sec                           |
| Duration      | 60초 per stage                          |
| User Levels   | 5 / 10 / 20 / 30 / 40 / 50            |
| Test Method   | 비계단식 독립 테스트                       |

## Performance Ranking

| Rank | Structure        | Max RPS | Saturate | avg @u40 | p99 @u40 |
|------|------------------|---------|----------|----------|----------|
|      | 17x4_region_fm   |         |          |          |          |
|      | 4x4_fm           |         |          |          |          |
|      | 2x3_fm           |         |          |          |          |

---

## nofm (forcemerge 전)

### lbt_17x4_region (nofm)

| Users | RPS  | avg  | p50  | p90  | p95  | p99  | errors |
|-------|------|------|------|------|------|------|--------|
| 5     | 1.3  | 414  | 180  | 1400 | 2600 | 3000 | 0      |
| 10    | 2.7  | 329  | 210  | 750  | 1300 | 1400 | 0      |
| 20    | 4.7  | 775  | 510  | 1800 | 2800 | 3600 | 0      |
| 30    | 5.7  | 1854 | 1800 | 3700 | 4200 | 4900 | 0      |
| 40    | 7.5  | 1804 | 1600 | 3700 | 4000 | 4200 | 0      |
| 50    | 6.6  | 3695 | 3700 | 6300 | 6500 | 7300 | 0      |

### lbt_4x4 (nofm)

| Users | RPS  | avg  | p50  | p90  | p95  | p99  | errors |
|-------|------|------|------|------|------|------|--------|
| 5     | 1.3  | 366  | 220  | 980  | 1200 | 1700 | 0      |
| 10    | 2.5  | 653  | 250  | 2600 | 2700 | 3600 | 0      |
| 20    | 4.5  | 1035 | 900  | 2200 | 2500 | 3000 | 0      |
| 30    | 5.8  | 1764 | 1200 | 4000 | 4500 | 5300 | 0      |
| 40    | 5.5  | 3391 | 3500 | 5300 | 6100 | 7200 | 0      |
| 50    | 5.7  | 4650 | 5100 | 6600 | 7000 | 7800 | 0      |

### lbt_2x3 (nofm)

| Users | RPS  | avg  | p50  | p90  | p95  | p99   | errors |
|-------|------|------|------|------|------|-------|--------|
| 5     | 1.3  | 268  | 160  | 610  | 980  | 1000  | 0      |
| 10    | 2.7  | 348  | 190  | 990  | 1100 | 1500  | 0      |
| 20    | 4.5  | 1057 | 440  | 3000 | 3900 | 4600  | 0      |
| 30    | 5.5  | 1955 | 1300 | 5200 | 5800 | 7800  | 0      |
| 40    | 5.5  | 3512 | 3300 | 7100 | 8800 | 11000 | 0      |
| 50    | 7.1  | 3482 | 3300 | 6300 | 6800 | 7600  | 0      |

---

## fm (forcemerge 후)

### lbt_17x4_region_fm

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 30    |     |     |     |     |     |     |        |
| 40    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

### lbt_4x4_fm

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 30    |     |     |     |     |     |     |        |
| 40    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

### lbt_2x3_fm

| Users | RPS | avg | p50 | p90 | p95 | p99 | errors |
|-------|-----|-----|-----|-----|-----|-----|--------|
| 5     |     |     |     |     |     |     |        |
| 10    |     |     |     |     |     |     |        |
| 20    |     |     |     |     |     |     |        |
| 30    |     |     |     |     |     |     |        |
| 40    |     |     |     |     |     |     |        |
| 50    |     |     |     |     |     |     |        |

---

## Saturation Point

| Tag              | nofm Saturate | nofm Max RPS | fm Saturate | fm Max RPS |
|------------------|---------------|--------------|-------------|------------|
| 17x4_region      | ~u40          | 7.5          |             |            |
| 4x4              | ~u30          | 5.8          |             |            |
| 2x3              | ~u30          | 5.5          |             |            |

## Findings

### nofm 결과

- **17x4_region이 nofm에서도 최상위**: u40에서 Max RPS 7.5 도달, 포화점이 가장 늦음
- **4x4와 2x3는 u30에서 포화**: 이후 RPS 정체, 지연만 증가
- **에러 0건**: 모든 구조에서 timeout/failure 없이 응답 완료 (느려질 뿐 실패하지 않음)
- **2x3의 p99 급등**: u40에서 p99=11000ms로 3개 구조 중 최악. 총 샤드 6개로 적지만, 샤드당 데이터가 무거워 고부하에서 꼬리 지연 심화
- **4x4 u50에서 p50=5100ms**: 중앙값 자체가 5초를 넘기며 사실상 서비스 불가 수준
- **17x4 u40 avg < u30 avg**: u40(1804ms) < u30(1854ms). 더 많은 유저인데 평균이 비슷하거나 낮음 → 워밍업 효과 추정
- **Locust E2E vs AWS 지연 괴리**: Locust가 측정하는 시간은 전체 경로(Locust→Spring→OS→Spring→Locust)이므로 AWS 콘솔의 OS 내부 지연(~500ms 이하)과 큰 차이 발생. 실 사용자 체감은 E2E 기준

### nofm Ranking (잠정)

| Rank | Structure   | Max RPS | Saturate | avg @u40 | p99 @u40 |
|------|-------------|---------|----------|----------|----------|
| 1    | 17x4_region | 7.5     | ~u40     | 1804     | 4200     |
| 2    | 4x4         | 5.8     | ~u30     | 3391     | 7200     |
| 3    | 2x3         | 5.5     | ~u30     | 3512     | 11000    |

(fm 결과 후 최종 정리 예정)
